# 菜單訓練功能設計

## 概述

讓用戶可以從訓練菜單開始訓練，依清單完成每個項目，並追蹤進度。

## 需求

| 項目     | 決定                                 |
| -------- | ------------------------------------ |
| 入口     | 菜單頁面，每個卡片加「開始訓練」按鈕 |
| 流程     | 清單總覽模式，自由選擇順序           |
| 完成顯示 | 預設打勾，可展開查看詳細數據         |
| 中途離開 | 詢問是否保留進度                     |
| 多次記錄 | 同一項目可記錄多次                   |
| 完成後   | 顯示訓練摘要                         |

## 架構設計

### 元件拆分

從 `/workout/new.tsx` 抽取記錄表單成獨立元件：

```
src/components/
  └── WorkoutRecordForm.tsx
```

**WorkoutRecordForm** 包含：

- 重量設定（含自體重量開關）
- 次數輸入
- 組數計數器
- 難易度選擇
- 備註輸入
- 歷史記錄快速填入

使用方式：

- `/workout/new.tsx` - 使用此元件，加上部位/項目選擇
- `/workout/menu/[menuId].tsx` - 在 Bottom Sheet 中使用此元件

### 頁面結構

```
菜單列表 (menus.tsx)
  └── 點擊「開始訓練」
        └── 訓練進行頁 (/workout/menu/[menuId].tsx)
              ├── 項目清單（可展開/收合）
              ├── 點擊項目 → 記錄 Bottom Sheet
              └── 完成 → 訓練摘要
```

## 頁面設計

### 菜單訓練頁面 (`/workout/menu/[menuId].tsx`)

```
┌─────────────────────────────┐
│  ← 返回        胸背日        │  Header（菜單名稱）
├─────────────────────────────┤
│  進度：2/5 完成              │  進度列
│  ████████░░░░░░░░           │
├─────────────────────────────┤
│  ✓ 臥推           ∨         │  已完成（可展開）
│    60kg × 10下 × 3組        │  展開後顯示記錄
│    65kg × 8下 × 2組         │  （支援多筆）
├─────────────────────────────┤
│  ✓ 啞鈴飛鳥       ∨         │
├─────────────────────────────┤
│  ○ 滑輪下拉       ＋         │  未完成（點擊記錄）
├─────────────────────────────┤
│  ○ 坐姿划船       ＋         │
├─────────────────────────────┤
│  ○ 繩索夾胸       ＋         │
├─────────────────────────────┤
│                             │
│     【完成訓練】             │  全部完成後出現
└─────────────────────────────┘
```

### 訓練摘要

```
┌─────────────────────────────┐
│                             │
│         訓練完成！           │
│                             │
├─────────────────────────────┤
│  📊 本次訓練統計             │
│                             │
│  ┌─────────┬─────────┐      │
│  │ 完成項目 │ 總組數   │      │
│  │    5    │   18    │      │
│  └─────────┴─────────┘      │
│                             │
│  ┌─────────┬─────────┐      │
│  │ 訓練時長 │ 總次數   │      │
│  │  45分鐘  │  156   │      │
│  └─────────┴─────────┘      │
│                             │
├─────────────────────────────┤
│  📝 訓練明細                 │
│  • 臥推：3組 + 2組          │
│  • 啞鈴飛鳥：3組            │
│  • ...                      │
├─────────────────────────────┤
│                             │
│       【返回首頁】           │
│                             │
└─────────────────────────────┘
```

### 菜單列表改動 (`menus.tsx`)

```
┌─────────────────────────────┐
│  胸背日                      │
│  練胸和背的組合       5 項目  │
│                             │
│  ┌──────────┐ ┌──────────┐  │
│  │  編輯    │ │ 開始訓練  │  │
│  └──────────┘ └──────────┘  │
└─────────────────────────────┘
```

若有未完成進度：

```
│  ┌──────────┐ ┌──────────┐  │
│  │  編輯    │ │繼續 (2/5)│  │
│  └──────────┘ └──────────┘  │
```

## 進度保存機制

使用 AsyncStorage 暫存進度：

```typescript
interface MenuSessionProgress {
  menuId: number;
  startedAt: string; // 開始時間
  records: SessionRecord[]; // 已記錄的項目
}

interface SessionRecord {
  exerciseId: number;
  sessionIds: number[]; // 對應 workout_sessions 的 ID
}
```

**運作流程：**

1. 開始訓練 → 建立 progress 存入 AsyncStorage
2. 完成一項 → 寫入 workout_sessions 資料表 + 更新 progress
3. 離開頁面 → 詢問是否保留進度
   - 保留：progress 留著，下次進入同菜單時恢復
   - 不保留：刪除 progress（已存的記錄保留在資料庫）
4. 全部完成 → 刪除 progress，顯示摘要

**優點：**

- 記錄即時寫入資料庫，不怕 App 閃退遺失
- 進度只是「哪些做完了」的索引，輕量

## 實作項目

1. 抽取 `WorkoutRecordForm` 元件
2. 重構 `/workout/new.tsx` 使用新元件
3. 建立進度管理 hook (`useMenuSession`)
4. 建立菜單訓練頁面 (`/workout/menu/[menuId].tsx`)
5. 改動菜單列表頁面，加入「開始訓練」按鈕
6. 實作訓練摘要顯示
